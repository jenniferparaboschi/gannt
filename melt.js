melt=function(n){"use strict";function r(n){for(var r={},n=n||[],t=0;t<n.length;t++)r[n[t]]=1;return r}function t(n,r){for(var t in r)n[t]=r[t];return n}function u(n,u,e,i,c){var a=[],e=e||"variable",i=i||"value",o=r(u);return n.forEach(function(n,r){var u=c?{}:{_id:r},f=[],s=[];for(var v in n)o[v]?u[v]=n[v]:(f.push(v),s.push(n[v]));for(var h=0;h<f.length;h++){var l={};l[e]=f[h],l[i]=s[h],a.push(t(l,u))}}),a}function e(n,r,u){var e=Array.prototype.slice.call(arguments,3),i={},c={};return n.forEach(function(n){var a={},o=r.map(function(r){return a[r]=n[r]}).join("\x00");i[o]||(i[o]=t({},a));var f=e.slice(0);f.unshift(n,i[o]),i[o]=u.apply(c,f)}),Object.keys(i).map(function(n){return i[n]})}return e.sum=function(r,t,u,e){if(!this.sum){var i=function(n,r,t,u){return r[t]=u.reduce(function(r,t){return r+n[t]},r[t]||0),r};this.sum=function(r,t){return e===n&&(e=u),"string"==typeof e&&(e=[e]),i(r,t,u,e)}}return this.sum(r,t)},e.count=function(n,r,t){return r[t]||(r[t]=0),r[t]+=1,r},u.cast=e,u}(),cast=melt.cast;
